local a=_DS18B20 and _DS18B20.pin;local function b()local c=ow.reset(a)ow.write(a,0xCC,1)ow.write(a,0x44,1)return c==1 end;local function d()ow.reset_search(a)local e,f={}repeat f=ow.search(a)if f then e[#e+1]=f end until not f;_DS18B20.adr=e;if#e>0 then b()end;return#e or false end;local function g(h)local i,j,c=""ow.reset(a)ow.select(a,h)ow.write(a,0xBE,1)for k=1,9 do i=i..string.char(ow.read(a))end;if ow.crc8(i:sub(1,8))==i:byte(9)then j=(i:byte(1)+i:byte(2)*256)*625;c=j/10000 .."."..j%10000 end;return c end;local function l(m)local e,n,c=_DS18B20.adr,{},false;if m>0 then c=e[m]and g(e[m])or c else for k,o in ipairs(e)do n[string.format("%X%X%X%X%X%X",e[k]:byte(2,7))]=g(o)end;c=n end;b()return c end;local function p(a)_DS18B20={}_DS18B20.pin=a;ow.setup(a)return true end;return function(q)local c=false;if q.init then c=p(q.init)end;if q.find and a then c=d()end;if q.scan and a then c=b()end;if q.get and a then c=l(q.get)end;return c end
